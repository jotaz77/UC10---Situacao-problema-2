
-- TRANSAÇÃO: Criação da tabela CLIENTES
-- Objetivo: Registrar os clientes que poderão realizar pedidos.

CREATE TABLE Clientes (
    id_cliente INT PRIMARY KEY AUTO_INCREMENT,
    nome VARCHAR(100) NOT NULL,
    telefone VARCHAR(20),
    cpf VARCHAR(14) UNIQUE NOT NULL,
    email VARCHAR(120)
);


-- TRANSAÇÃO: Criação da tabela PRODUTOS
-- Objetivo: Armazenar os produtos vendidos pela empresa Coma Bem.

CREATE TABLE Produtos (
    id_produto INT PRIMARY KEY AUTO_INCREMENT,
    nome VARCHAR(100) NOT NULL,
    descricao TEXT,
    preco DECIMAL(10,2) NOT NULL,
    quantidade_estoque INT NOT NULL
);


-- TRANSAÇÃO: Criação da tabela PEDIDOS
-- Objetivo: Armazenar os pedidos realizados pelos clientes.

CREATE TABLE Pedidos (
    id_pedido INT PRIMARY KEY AUTO_INCREMENT,
    id_cliente INT NOT NULL,
    data_pedido DATE NOT NULL,
    valor_total DECIMAL(10,2) NOT NULL,
    FOREIGN KEY (id_cliente) REFERENCES Clientes(id_cliente)
);


-- TRANSAÇÃO: Criação da tabela ITENS_PEDIDO
-- Objetivo: Armazenar os produtos associados a cada pedido.

CREATE TABLE Itens_Pedido (
    id_item INT PRIMARY KEY AUTO_INCREMENT,
    id_pedido INT NOT NULL,
    id_produto INT NOT NULL,
    quantidade INT NOT NULL,
    subtotal DECIMAL(10,2) NOT NULL,
    FOREIGN KEY (id_pedido) REFERENCES Pedidos(id_pedido),
    FOREIGN KEY (id_produto) REFERENCES Produtos(id_produto)
);


-- ================== TRANSAÇÕES DO SISTEMA ==================



-- TRANSAÇÃO: Inserção de um novo cliente
-- Objetivo: Cadastrar um cliente no sistema.

INSERT INTO Clientes (nome, telefone, cpf, email)
VALUES ('João da Silva', '1199999-9999', '123.456.789-00', 'joao@email.com');


-- TRANSAÇÃO: Inserção de um novo produto
-- Objetivo: Registrar um produto no catálogo.

INSERT INTO Produtos (nome, descricao, preco, quantidade_estoque)
VALUES ('Pizza Marguerita', 'Pizza artesanal com tomate e manjericão', 39.90, 50);


-- TRANSAÇÃO: Registro de um novo pedido
-- Objetivo: Criar um pedido vinculado a um cliente.

INSERT INTO Pedidos (id_cliente, data_pedido, valor_total)
VALUES (1, '2025-12-03', 79.80);


-- TRANSAÇÃO: Inserção dos itens do pedido
-- Objetivo: Associar os produtos ao pedido realizado.

INSERT INTO Itens_Pedido (id_pedido, id_produto, quantidade, subtotal)
VALUES (1, 1, 2, 79.80);


-- TRANSAÇÃO: Atualização do estoque após venda
-- Objetivo: Deduzir a quantidade vendida do estoque.

UPDATE Produtos
SET quantidade_estoque = quantidade_estoque - 2
WHERE id_produto = 1;


-- TRANSAÇÃO: Atualização dos dados de um cliente
-- Objetivo: Editar informações cadastrais conforme necessidade.

UPDATE Clientes
SET telefone = '1188888-7777'
WHERE id_cliente = 1;


-- TRANSAÇÃO: Cancelamento de pedido
-- Objetivo: Apagar pedido e restaurar o estoque.

DELETE FROM Itens_Pedido WHERE id_pedido = 1;
DELETE FROM Pedidos WHERE id_pedido = 1;

-- Restaurar estoque (exemplo)
UPDATE Produtos
SET quantidade_estoque = quantidade_estoque + 2
WHERE id_produto = 1;


-- TRANSAÇÃO: Exclusão de um produto
-- Objetivo: Remover produto do catálogo.

DELETE FROM Produtos WHERE id_produto = 1;
